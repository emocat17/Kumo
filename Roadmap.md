# Kumo 开发路线图 (Roadmap)

> **基于 Docker 的现代化 Python 任务调度与全栈环境管理平台**
>
> 本文档记录了 Kumo 项目的开发愿景、详细功能清单及当前进度。

## 🌟 核心目标
打造一个功能完善、易于管理的**单机/轻量级分布式**爬虫任务管理平台，具备以下核心特性：
- **可视化任务管理与监控**：全生命周期的任务控制与数据洞察。
- **灵活的 Python 环境隔离**：基于 Conda/Venv 的项目级环境管理，解决依赖冲突。
- **高效的资源利用率**：容器化部署与资源监控。
- **健壮的任务调度机制**：容错、重试、超时控制与日志审计。

---

## 🛠️ 详细功能清单 (Feature Inventory)

### 1. 基础设施与系统管理 (Infrastructure)
#### 1.1 环境管理 (Environment Management)
- [x] **Python 版本/环境隔离**:
    - [x] 支持 Conda 环境创建与管理。
    - [x] 支持系统 Python 解释器注册。
    - [x] 自动识别 Docker 容器内环境路径。
- [x] **依赖包管理**:
    - [x] 可视化安装/卸载 Python 包 (支持 `pip` 和 `conda` 命令)。
    - [x] 支持上传 `requirements.txt` 批量安装。
    - [x] 实时查看安装日志 (WebSocket/Polling)。
    - [x] **自定义 PyPI 镜像源**: 支持配置多个镜像源并调整优先级。
- [x] **系统配置**:
        - [x] **全局环境变量**: 支持设置系统级环境变量，自动注入所有任务。
        - [x] **网络代理**: 支持配置全局 HTTP/HTTPS 代理，自动注入容器与任务环境。
        - [x] **敏感信息加密**: `SECRET` 类型环境变量在数据库中加密存储，前端脱敏显示。
        - [x] **数据备份**:
        - [x] 手动触发数据库备份。
        - [x] 备份文件列表查看与下载。
        - [x] 备份文件删除管理。
        - [x] 自动定时备份 (SystemScheduler)。
    - [x] **系统监控**: 实时展示 CPU、内存、磁盘 IO、网络流量及分区使用率。

#### 1.2 项目管理 (Project Management)
- [x] **项目生命周期**:
    - [x] **ZIP 上传**: 支持拖拽上传 ZIP 包，后端自动解压。
    - [x] **安全删除**: 采用“重命名回收站 + 延迟删除”策略，防止文件锁冲突；检查任务引用防止误删。
    - [x] **元数据管理**: 修改项目名称、描述、工作目录 (`work_dir`)。
- [x] **文件系统集成**:
    - [x] **在线文件浏览**: 树形结构展示项目文件。
    - [x] **在线代码查看**: 支持查看代码文件内容 (Monaco Editor)。
    - [x] **输出路径映射**: 支持配置独立的数据输出目录 (`output_dir`)，并在任务执行时自动注入环境变量 (`OUTPUT_DIR`, `DATA_DIR`)。
    - [x] **服务器目录浏览**: 在配置输出路径时提供服务器文件夹选择器。
- [x] **智能辅助**:
    - [x] **框架检测**: 自动识别 Scrapy (`scrapy.cfg`)、通用 Python (`main.py`, `app.py`) 项目，并推荐执行命令。

### 2. 任务调度与执行 (Task Management)
#### 2.1 调度核心 (Core Scheduling)
- [x] **多种触发器支持**:
    - [x] **Cron 表达式**: 支持标准 Linux Crontab 语法。
    - [x] **Interval (间隔)**: 支持秒/分/时/天/周循环。
    - [x] **Date (一次性)**: 指定特定时间执行。
    - [x] **Cron 预览**: 创建任务时实时预览下 5 次执行时间。
- [x] **健壮性保障**:
    - [x] **超时控制**: 支持设置任务最大运行时间 (`timeout`)，超时自动终止。
    - [x] **自动重试**: 支持配置重试次数 (`retry_count`) 和重试间隔 (`retry_delay`)。
    - [x] **优先级队列**: 支持任务优先级设置 (Priority 0-2)，影响调度顺序。
- [x] **任务控制**:
    - [x] **手动触发**: 支持“立即执行”按钮。
    - [x] **暂停/恢复**: 动态暂停或恢复调度任务。
    - [x] **强制停止**: 支持终止正在运行的任务进程。

#### 2.2 执行环境 (Execution Context)
- [x] **环境注入**: 自动注入全局环境变量 + 项目特定路径变量。
- [x] **资源隔离**: 独立子进程 (`subprocess`) 执行。
- [x] **资源监控**: 实时监控子进程 CPU 和 内存占用，记录峰值数据 (`max_cpu`, `max_mem`)。

### 3. 日志与审计 (Logging & Audit)
#### 3.1 任务日志 (Task Logs)
- [x] **日志管理**:
    - [x] 自动捕获标准输出 (stdout) 和错误输出 (stderr) 至日志文件。
    - [x] 日志文件按任务分组展示。
    - [x] 支持按项目筛选日志。
- [x] **日志交互**:
    - [x] **实时查看**: 支持 Web 端实时查看运行中任务的日志流。
    - [x] **内容搜索**: 支持在日志文件中通过关键词搜索 (grep-like)。
    - [x] **下载**: 支持下载完整日志文件。
    - [x] **清理策略**: 支持手动批量删除、按时间 (7/30/90天) 自动清理。

#### 3.2 审计日志 (Audit Trails)
- [x] **全操作记录**: 记录创建、更新、删除、执行、停止等关键操作。
- [x] **详细信息**: 记录操作时间、操作人 IP、操作对象及详细变更内容。
- [x] **查询筛选**: 支持按操作类型、目标类型筛选，支持关键词搜索。

### 4. 监控与可视化 (Dashboard)
- [x] **系统概览**:
    - [x] 关键指标卡片 (CPU/Mem/Disk/Tasks)。
    - [x] 实时运行任务计数。
- [x] **统计图表**:
    - [x] **每日执行趋势**: 过去 14 天的任务成功/失败柱状图。
    - [x] **成功率统计**: 过去 7 天整体成功率。
    - [x] **失败 TOP 5**: 统计近期失败次数最多的任务。
- [x] **交互体验**:
    - [x] 页面可见性检测 (自动暂停/恢复轮询)。
    - [x] 项目维度的数据筛选。

---

## 🚀 待开发规划 (Future Roadmap)

### Phase 4: 生态与扩展 (v1.5.0+)

- [ ] **高级数据管理**:
    - [ ] 在线预览爬虫结果数据 (CSV/JSON/SQLite)。
    - [ ] 数据导出工具。
- [ ] **分布式集群 (Cluster)**:
    - [ ] 节点注册与心跳机制。
    - [ ] 任务分发与远程执行。

---

## 🛠️ 技术栈 (Tech Stack)
- **Frontend**: Vue 3, Vite, TypeScript, Pinia, Lucide Icons, ECharts.
- **Backend**: Python 3.9+, FastAPI, SQLAlchemy, APScheduler, Psutil.
- **Runtime**: Docker, Docker Compose, Conda.
- **Database**: SQLite (Default).

## 📅 版本记录
- **v1.0.0**: 完成核心调度、环境管理、日志审计及仪表盘功能 (当前阶段)。
