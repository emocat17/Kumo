# 任务验收报告：修复“停止任务”失效问题

## 1. 问题复盘
- **现象**：用户点击“停止任务”后，尽管UI提示已停止，但在后台爬虫仍在继续下载文件。
- **原因**：后端 `task_manager.py` 在启动任务时使用了 `shell=True`。
    - 在 Linux (容器环境) 中，这会创建一个 Shell 进程 (`/bin/sh`) 作为父进程，而实际的 Python 任务脚本是其子进程。
    - 当后端发送停止信号 (`SIGTERM`) 时，信号只发给了 Shell 进程。Shell 进程退出，但子进程（爬虫）变成了孤儿进程并继续运行。
- **违反规范**：该实现违反了项目开发规范中的 **"3. Shell 安全: ...禁止 shell=True"**。

## 2. 修复内容
- **代码修改**：
    - `backend/appTask/task_manager.py`:
        - 引入 `shlex` 模块用于正确解析命令字符串。
        - 将 `subprocess.Popen` 的参数改为 `shell=False`。
        - 使用 `shlex.split(cmd)` 将命令字符串转换为列表格式（如 `['python', 'script.py', '--arg']`）。
- **效果**：
    - 现在 `process.pid` 直接指向 Python 任务进程。
    - 点击停止时，`terminate()` 信号直接发送给任务进程，能够立即终止任务。

## 3. 验证步骤
1.  重启 Backend 服务 (已完成)。
2.  启动一个耗时较长的任务（如爬虫）。
3.  在日志窗口点击红色“停止”按钮。
4.  观察日志不再更新，且后台无残留进程（下载停止）。

## 4. 结论
- 修复完成。遵循了现有的 Shell 安全规范。
