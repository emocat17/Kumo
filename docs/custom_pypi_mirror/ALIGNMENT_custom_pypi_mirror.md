# ALIGNMENT: 自定义 PyPI 镜像源配置

## 1. 项目上下文分析

当前 Kumo 项目是一个爬虫任务管理平台，支持 Python 环境管理（Conda/Venv）。用户可以在平台上创建独立的 Python 环境并安装依赖。
目前依赖安装可能直接连接官方 PyPI 源，导致在国内网络环境下速度较慢或超时。

### 现有架构
- **Backend**: FastAPI, SQLite (TaskManage.db).
- **Environment Management**: `appEnv` 模块负责创建环境和安装依赖。
- **Frontend**: Vue 3, 有 Environments 页面管理环境。

## 2. 需求理解

### 原始需求
- "支持用户在前端配置 PyPI 镜像源，加速依赖安装。"

### 核心功能
1.  **全局配置存储**: 需要在后端持久化存储 PyPI 镜像源地址。
2.  **配置界面**: 前端需要提供界面供用户查看及修改镜像源。
3.  **应用配置**: 在执行 `pip install` 相关操作时，自动使用配置的镜像源。

## 3. 智能决策策略

### 关键决策点

1.  **配置存储位置**:
    - *选项 A*: 配置文件 (config.yaml)
    - *选项 B*: 数据库表 (SystemConfig)
    - *决策*: 选择 **选项 B (数据库表)**。因为需要前端动态修改且无需重启服务，数据库更合适，且方便未来扩展其他全局配置。

2.  **配置生效范围**:
    - 仅影响通过平台进行的 `pip install` 操作。
    - 不影响 Docker 镜像构建过程（那是运维层面的）。

3.  **默认值**:
    - 默认为官方源 `https://pypi.org/simple`，或者留空表示使用系统默认。
    - 常用国内源预设（阿里云、清华源等）可作为前端选项提供，但后端只存 URL。

## 4. 疑问与澄清

- **Q1**: 是否需要支持每个环境单独配置源？
  - *A1*: 暂不需要。需求描述为"用户在前端配置 PyPI 镜像源"，通常指全局默认配置。个别环境的特殊需求可以通过手动终端操作解决（如果开放了终端），或者作为后续高级特性。目前按**全局配置**实现。

- **Q2**: 镜像源配置修改后，是否需要同步到已存在环境的 `pip.conf`？
  - *A2*: 为了简化实现，我们可以在每次调用 `pip install` 命令时通过 `-i` 参数指定源，而不是修改配置文件。这样更灵活且无侵入性。

## 5. 待确认事项

无。基于上述分析，方案清晰。

